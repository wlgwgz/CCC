<!-- 注意事项 -->
<!-- 起始分级标题：##（二级标题） -->

## 空调&热水模式切换

- 若满足以下任意条件时，则无空调&热水模式切换逻辑：
  - **【模块个数】** ＞ 1，且 **【热水模块数】** ＜ **【模块个数】**
  - **【热水功能】** 设为 “禁用”

- 否则，有以下空调&热水模式切换逻辑。

### 热水优先

**【热水模式优先】** 设为 “使用” 时，所有机组优先制热水运行，并进入热水优先动作周期，其逻辑如下：
![空调&热水模式切换-热水模式优先-使用](.img/空调&热水模式切换-热水模式优先-使用.svg#large)

- 其中
  - **HOTW**：制热水运行
  - **COOL(HEAT)**：制冷（或制热）运行
  - **t_HWt_on_max**：**【制热水最大时长】**
  - **t_HWt_off_max**：**【制热水限制运行】**
  - **THWt_stop**：**【热水设定温度】**
  - **THWt_start**：**【热水设定温度】** - **【热水回差】**

1. “制热水运行” 期间，执行以下逻辑判断：
   - 当 0 ≤ 制热水运行时间 ＜ **【制热水最大时长】** 时：
     - **【缓冲水箱上部温度探头】** 和 **【缓冲水箱下部温度探头】** 均设为 “禁用” 时：
       - 若此时只要存在 **制热水需求**，则所有机组制热水运行
       - 若此时无 **制热水需求**，且 **变频水泵`PUMPf`** 运行超过2分钟，则所有机组将切换至制冷（或制热）运行
       - 当 制热水运行时间 ≥ **【制热水最大时长】** 时，所有机组将切换至制冷（或制热）运行
     - **【缓冲水箱上部温度探头】** 和 **【缓冲水箱下部温度探头】** 中存在 “使用” 时:
       - 若此时只要存在 **制热水需求** 时，则所有机组制热水运行
       - 若此时无 **制热水需求**，且存在 **制冷需求** / **制热需求**，且 **变频水泵`PUMPf`** 运行超过2分钟，则所有机组可提前切换至制冷（或制热）运行
       - 若此时无 **制热水需求**，且无 **制冷需求** / **制热需求**，且 **变频水泵`PUMPf`** 运行超过2分钟，则所有机组的 **变频压机`COMPf`** 关闭
   - 当 制热水运行时间 ≥ **【制热水最大时长】** 时，所有机组将切换至制冷（或制热）运行。

2. “制冷（或制热）运行” 期间，执行以下逻辑判断：
   - 当 0 ≤ 制冷（或制热）运行时间 ＜ **【制热水限制运行】** 时：
     - 若此时存在 **制冷需求** / **制热需求**，且无 **制热水需求**，则所有机组制冷（或制热）运行
     - 若此时无 **制冷需求** / **制热需求**，且存在 **制热水需求**，且 **变频水泵`PUMPf`** 运行超过2分钟，则所有机组可提前切换至制热水运行
   - 当 制冷（或制热）运行时间 ≥ **【制热水限制运行】** 时，所有机组切换至制热水运行

3. 在以上过程中，**环境温度`TA`** 处于 “压机关闭区” 时，则不立即切换模式，需等相应时间段内的计时完成后方可切换模式

4. 相关部件动作
   - **水箱电热`TBH`** 动作逻辑，详见 “水箱电热控制” 章节
   - **辅助电热1`IBH1`** 和 **辅助电热2`IBH2`** 动作逻辑，详见 “辅助电热控制” 章节
   - **变频压机`COMPf`** 动作逻辑，详见 “变频压机启停控制” 章节

### 空调优先

**【热水模式优先】** 设为 “禁用” 时，所有机组优先制冷（或制热）运行，其逻辑如下：
![空调&热水模式切换-热水模式优先-禁用](.img/空调&热水模式切换-热水模式优先-禁用.svg#large)

- 其中
  - **COOL(HEAT)**：制冷（或制热）运行
  - **HOTW**：制热水运行
  - **t_TBH_on_dly**：**【水箱电热开启延】**
  - **THWt_stop**：**【热水设定温度】**
  - **THWt_start**：**【热水设定温度】**-**【热水回差】**

1. “制冷（或制热）运行” 期间，执行以下逻辑判断：
   - 若此时存在 **制冷需求** / **制热需求** 时，则所有机组制冷（或制热）运行
   - 若此时无 **制冷需求** / **制热需求**，且存在 **热水需求**，且 **变频水泵`PUMPf`** 运行超过2分钟，则所有机组可提前切换至制热水运行

2. “制热水运行” 期间，执行以下逻辑判断；
   - 若 **【缓冲水箱上部温度探头】** 和 **【缓冲水箱下部温度探头】** 均设为 “禁用” 时：
     - 当 0 ≤ 制热水运行时间 ＜ **【制热水最大时长】** 时，若此时存在 **热水需求**，则所有机组制热水运行。否则，所有机组将切换至制冷（或制热）运行
     - 当 制热水运行时间 ≥ **【制热水最大时长】** 时，所有机组将切换至制冷（或制热）运行
   - 若 **【缓冲水箱上部温度探头】** 和 **【缓冲水箱下部温度探头】** 中存在 “使用” 时：
     - 若此时存在 **制热水需求**，且无 **制冷需求** / **制热需求**，则所有机组制热水运行
     - 若此时存在 **制冷需求** / **制热需求**，则所有机组将切换至制冷（或制热）运行
     - 若此时无 **制热水需求**，且无 **制冷需求** / **制热需求**，则所有机组的 **变频压机`COMPf`** 关闭
   - 若在以上过程中，**环境温度`TA`** 处于“压机关闭区”时，则不立即切换模式，需等相应时间段内的计时完成后方可切换模式
   - 相关部件动作：
     - **水箱电热`TBH`** 动作逻辑，详见 “水箱电热控制” 章节
     - **辅助电热1`IBH1`** 和 **辅助电热2`IBH2`** 动作逻辑，详见 “辅助电热控制” 章节
     - **变频压机`COMPf`** 动作逻辑，详见 “变频压机启停控制” 章节
