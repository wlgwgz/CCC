<!-- 注意事项 -->
<!-- 起始分级标题：##（二级标题） -->

## 辅助电热控制

当满足以下任意条件时，**辅助电热1`IBH1`** 和 **辅助电热2`IBH2`** 始终保持关闭：

- 拨码SW1设置为 “禁用”
- 【**辅助电热**】设为 “禁用”
- 水流不足故障
- 进入能力测试
- 进入地暖预热功能
- 进入地暖烘干功能
- **总出水温度`TWout2`** ＞ 70℃（当 **总出水温度`TWout2`** ≥ 70℃时,存在5℃回差）
- **变频水泵`PUMPf`** 未运行

当未进入 “**待机态防冻**” 或 “**运行态防冻**” 或商检功能，且满足以下任意条件时，**辅助电热1`IBH1`** 和 **辅助电热2`IBH2`** 始终保持关闭：

- 机组制热运行，且【**辅助电热**】设为“仅热水”
- 机组制热水运行，且【**辅助电热**】设为“仅制热”
- 机组制冷运行
- 机组制热水运行，且 **水箱电热`TBH`** 开启

定义“辅助电热控制温度”：

- “能调控制对象” 为出水时为 **总出水温度`TWout2`**
- “能调控制对象” 为回水时按以下条件选择：
  - **缓冲水箱下部温度`TACt2`** 均可用时：AVG(**缓冲水箱上部温度`TACt1`**, **缓冲水箱下部温度`TACt2`**)
  - 仅 **缓冲水箱上部温度`TACt1`** 可用时：**缓冲水箱上部温度`TACt1`**
  - 仅 **缓冲水箱下部温度`TACt2`** 可用时：**缓冲水箱下部温度`TACt2`**

### 机组制热运行时控制

机组制热运行，且无“辅助电热控制温度”对应的故障时，有以下控制逻辑：

- 若辅助电热所在模块上的压机处于“压机正常状态”时，有以下控制逻辑：
  - 当满足以下所有条件时，辅助电热有开启需求：
    - **环境温度`TA`** ＜【**辅助电热开环温**】- 1℃
    - “辅助电热控制温度” ≤ 调频目标温度 –【**辅助电热开温差**】
    - 制热累计运行时间 ≥【**辅助电热开启延**】
  - 当满足以下任意条件时，辅助电热无开启需求：
    - **环境温度`TA`** ≥【**辅助电热开环温**】
    - “辅助电热控制温度” > 调频目标温度
- 若辅助电热所在模块上的压机处于“压机异常状态”时，有以下控制逻辑：
  - 辅助电热有开启需求：“辅助电热控制温度” ≤ 调频目标温度 –【**辅助电热开温差**】
  - 辅助电热无开启需求：“辅助电热控制温度” ≥ 调频目标温度
- 档位计算温度（用于后面计算电热档位需求）
  - 档位目标温度：调频目标温度
  - 档位当前温度：“辅助电热控制温度”

### 机组制热水运行时控制

机组制热水运行，且无热水水箱温度故障时，有以下控制逻辑：

- 若辅助电热所在模块上的压机处于“压机正常状态”时，有以下控制逻辑：
  - 当满足以下所有条件时，辅助电热有开启需求：
    - 制热水累计运行时间 ≥【**辅助电热开启延**】
    - **热水水箱温度`THWt`** ＜ 40℃
  - 当满足以下条件时，辅助电热无开启需求：
    - 辅助电热无开启需求：**热水水箱温度`THWt`** >【**热水设定温度**】
- 若辅助电热所在模块上的压机处于“压机异常状态”时，有以下控制逻辑：
  - 辅助电热有开启需求：**热水水箱温度`THWt`** ＜【**热水设定温度**】-【**热水回差**】
  - 辅助电热无开启需求：**热水水箱温度`THWt`** >【**热水设定温度**】
- 档位计算温度（用于后面计算电热档位需求）
  - 档位目标温度：【**热水设定温度**】（注：定时杀菌时为【**杀菌温度**】）
  - 档位当前温度：**热水水箱温度`THWt`**

### 防冻时控制

- 防冻时辅助电热控制请参见 “待机态防冻功能”、“运行态防冻功能” 章节
- 防冻需要辅助电热开启时，辅助电热有开启需求，否则无辅助电热开启需求。
- 档位计算温度（用于后面计算电热档位需求）
  - 无计算温度，档位恒为3档

### 商检时控制

- 商检需要辅助电热开启时，辅助电热有开启需求，否则无辅助电热开启需求。
- 档位计算温度（用于后面计算电热档位需求）
  - 无计算温度，档位恒为3档

### 制热运行时除霜控制

无总出水温度故障时，有以下控制逻辑：

- 当满足以下所有条件时，辅助电热有开启需求：
  - 机组正在除霜
  - **总出水温度`TWout2`** ≤ 16℃
- 当满足以下任意条件时，辅助电热无开启需求：
  - 机组退出除霜
  - **总出水温度`TWout2`** ≥ 20℃
- 档位计算温度（用于后面计算电热档位需求）
  - 档位目标温度：20℃
  - 档位当前温度：**总出水温度`TWout2`**

### 制热水运行时除霜控制

无热水水箱温度故障时，有以下控制逻辑：

- 当满足以下所有条件时，辅助电热有开启需求：
  - 机组正在除霜
  - **热水水箱温度`THWt`** ≤ 16℃
- 当满足以下任意条件时，辅助电热无开启需求：
  - 机组退出除霜
  - **热水水箱温度`THWt`** ≥ 20℃
- 档位计算温度（用于后面计算电热档位需求）
  - 档位目标温度：20℃
  - 档位当前温度：**热水水箱温度`THWt`**

### 强开热水模式时控制

无热水水箱温度故障和总出水温度故障时，有以下控制逻辑：

- 当满足以下所有条件时，辅助电热有开启需求：
  - 进入强开热水模式功能
  - **热水水箱温度`THWt`** ＜【**热水设定温度**】-【**热水回差**】
- 当满足以下任意条件时，辅助电热无开启需求：
  - **热水水箱温度`THWt`** ≥【**热水设定温度**】
  - 接收到热水关机命令
  - 退出强开热水模式
- 档位计算温度（用于后面计算电热档位需求）
  - 档位目标温度：【**热水设定温度**】
  - 档位当前温度：**热水水箱温度`THWt`**

### 制热强开辅助电热

无“辅助电热控制温度”对应的故障时，有以下控制逻辑：

- 当满足以下所有条件时，辅助电热有开启需求：
  - 接收到强开辅助电热命令
  - “辅助电热控制温度” ＜ 调频目标温度 -【**辅助电热开温差**】
- 当满足以下任意条件时，辅助电热无开启需求：
  - 接收到关机命令
  - 退出强开辅助电热模式
  - “辅助电热控制温度” ≥ 调频目标温度
- 档位计算温度（用于后面计算电热档位需求）
  - 档位目标温度：调频目标温度
  - 档位当前温度：“辅助电热控制温度”

### 制热水强开辅助电热

无热水水箱温度故障和总出水温度故障时，有以下控制逻辑：

- 当满足以下所有条件时，辅助电热有开启需求：
  - 接收到强开辅助电热命令
  - **热水水箱温度`THWt`** ＜【**热水设定温度**】 -【**热水回差**】
- 当满足以下任意条件时，辅助电热无开启需求：
  - 接收到关机命令
  - **热水水箱温度`THWt`** ≥【**热水设定温度**】
- 档位计算温度（用于后面计算电热档位需求）
  - 档位目标温度：【**热水设定温度**】
  - 档位当前温度：**热水水箱温度`THWt`**

### 定时杀菌时控制

![辅助电热控制-定时杀菌时控制](.img/辅助电热控制-定时杀菌时控制.svg#large)

- 其中
  - **THWdi_stop**：MIN(70℃,【**杀菌温度**】+1℃)
  - **THWdi_start**：【**杀菌温度**】-2℃
  - **THWt_stop**：【**热水设定温度**】
  - **THWt_start**：【**热水设定温度**】-【**热水回差**】
  - **t_HWdi_high**：【**杀菌高温时间**】
  - **t_HWdi_max**：【**杀菌最大周期**】
  - **S1**：杀菌阶段1
  - **S2**：杀菌阶段2
  - **SK**：落入该区域前的杀菌阶段（**S1** 或 **S2**）

- 处于杀菌阶段1：机组制热水运行时，**辅助电热1`IBH1`** 和 **辅助电热2`IBH2`** 动作逻辑请参见 “机组制热水运行时控制”
- 处于杀菌阶段2：辅助热源杀菌时，**辅助电热1`IBH1`** 和 **辅助电热2`IBH2`** 动作逻辑如下：
  - 当 0 ＜ 杀菌时间 ＜【**杀菌最大周期**】，且 高温杀菌时间 ＜【**杀菌高温时间**】时，有以下控制逻辑：
    - 当满足以下所有条件时，辅助电热有开启需求：
      - 机组无制热水需求，压机到温停机
      - **水箱电热`TBH`** 未开启
      - **热水水箱温度`THWt`** ≤【**杀菌温度**】-【**热水回差**】
    - 当满足以下任意条件时，辅助电热无开启需求：
      - **热水水箱温度`THWt`** ≥【**杀菌温度**】
    - 档位计算温度（用于后面计算电热档位需求）
      - 档位目标温度：【**杀菌温度**】
      - 档位当前温度：**热水水箱温度`THWt`**
  - 当 杀菌时间 ≥ 【**杀菌最大周期**】，或 高温杀菌时间 ≥【**杀菌高温时间**】时，辅助电热无开启需求，并退出定时杀菌功能。

### 制热试运行时控制

- 当满足以下所有条件时，辅助电热有开启需求：
  - 进入制热试运行功能
  - 制热试运行时间 ＞ 10分钟
- 当满足以下任意条件时，辅助电热无开启需求：
  - 退出制热试运行功能
  - 制热试运行时辅助电热开启时间 ＞ 3分钟

### 档位计算

- 辅助电热无开启需求时：**辅助电热1`IBH1`** 和 **辅助电热2`IBH2`** 均不输出
- 辅助电热有开启需求时，按如下方式进行档位计算：
  ![辅助电热控制-档位计算](.img/辅助电热控制-档位计算.svg#large)

  - 其中
    - Tgear_sv：档位目标温度
    - Tgear_pv：档位当前温度
    - dT_high：【**辅热开启高温差**】
    - dT_low：【**辅热开启低温差**】

  - 挡位当前温度落入GEAR0时，辅助电热开启0档
  - 挡位当前温度落入GEAR1时，辅助电热开启1档
  - 挡位当前温度落入GEAR2时，辅助电热开启2档
  - 挡位当前温度落入GEAR3时，辅助电热开启3档
- 注：若同时存在多种电热需求时，分别计算每种情况的档位需求，取最高档位需求作为最后输出

### 档位输出

- 辅助电热可通过拨码SW1进行配置，详见“附录1：电气连接示意图”
- 不同配置下，**辅助电热1`IBH1`** 和 **辅助电热2`IBH2`** 的输出动作如下表所示：
  - 辅助电热拨码 = “00” 时，**辅助电热1`IBH1`** 和 **辅助电热2`IBH2`** 保持关闭
  - 辅助电热拨码 = “01” 时：
    | 开启需求 | **辅助电热1`IBH1`** | **辅助电热2`IBH2`** |
    | -------- | ------------------- | ------------------- |
    | 关闭     | 关闭                | 关闭                |
    | 开启     | 开启                | 关闭                |

  - 辅助电热拨码 = “10” 时：
    | 开启需求 | **辅助电热1`IBH1`** | **辅助电热2`IBH2`** |
    | -------- | ------------------- | ------------------- |
    | 关闭     | 关闭                | 关闭                |
    | 开启     | 关闭                | 开启                |

  - 辅助电热拨码 = “11” 时，可通过参数【**辅助电热调档**】选择能调档位：
    - 【**辅助电热调档**】＝1：
      | 计算档位 | **辅助电热1`IBH1`** | **辅助电热2`IBH2`** |
      | -------- | ------------------- | ------------------- |
      | 0档      | 关闭                | 关闭                |
      | 1档      | 开启                | 开启                |
    - 【**辅助电热调档**】＝2：
      | 计算档位 | **辅助电热1`IBH1`** | **辅助电热2`IBH2`** |
      | -------- | ------------------- | ------------------- |
      | 0档      | 关闭                | 关闭                |
      | 1档      | 开启                | 关闭                |
      | 2档      | 开启                | 开启                |
    - 【**辅助电热调档**】＝3：
      | 计算档位 | **辅助电热1`IBH1`** | **辅助电热2`IBH2`** |
      | -------- | ------------------- | ------------------- |
      | 0档      | 关闭                | 关闭                |
      | 1档      | 开启                | 关闭                |
      | 2档      | 关闭                | 开启                |
      | 3档      | 开启                | 开启                |
