<!-- 注意事项 -->
<!-- 起始分级标题：##（二级标题） -->

## 商检功能

商检屏下发开始商检命令后有商检功能逻辑

### 内机静态故障检测

内机或整机商检时有内机静态检测逻辑：

#### 显示器通讯故障

- hmi故障计时 > 10s，报”**显示屏通讯故障**“（**ERR HMI**）
- hmi通讯成功计数 > 10次，复位”**显示屏通讯故障**“

#### 拨码开关故障

- 商检屏配置拨码与内机拨码不一致，报"**拨码开关故障**"（**ERR SW**）

#### 拨盘地址故障

- 商检屏配置拨盘与内机拨盘不一致，报"**拨盘地址故障**"（**ERR ADDR**）

#### 线控器WIFI故障

若商检屏配置开启WIFI商检，则有线控器WIFI故障检测：

- 线控器WIFI商检状态有4种：无模块、测试中、测试成功、测试失败
  - 无模块：报"**无WiFi模组**"（**ERR WIFI NO MODULE**）
  - 测试中：这个状态保持80秒会报"**WiFi测试超时**"（**ERR WIFI OVER**）
  - 测试失败：会报"**WiFi模组故障**"（**ERR WIFI ERROR**）

#### 其它故障

- 非商检的故障会报"**其它故障**"（**ERR OTHER**）

### 内机商检

内机或整机商检时有内机商检逻辑：

#### 步骤1：开变频水泵

- **变频水泵`PUMPf`** 运行17s后到达稳定状态且无故障时，步骤1完成，进入步骤2，否则内机商检失败

#### 步骤2：开辅助电热

- 若未使用 **辅助电热1`IBH1`** 且未使用 **辅助电热2`IBH2`**，步骤2直接判断为完成
- 若使用任意辅助电热，则会开启被使用的辅助电热，若满足以下所有条件，步骤2完成
  - **总出水温度`TWout2`** > **板换出水温度`TWout1`**
  - **总出水温度`TWout2`** 上升10℃
  - “**商检电热延时**”计时到 或 “**商检电热延时**”+“**商检电热超时**”计时到
- 若不满足上面的条件，则内机商检失败，且报**IBH故障**（**ERR IBH**）

> **注1**：**商检电热延时** = 【**商检电热时间**】除以100的余数
> **注2**：**商检电热超时** = 【**商检电热时间**】除以100的商

#### 内机商检结论

- 所有步骤都完成后，且无其它异常，则商检屏显示 **Pass**，表示商检通过

### 外机商检

外机或整机商检时有外机商检逻辑：

#### 步骤1：准备制热

准备制热执行动作：

- “空调模式” 设为制热
- **变频风机`FANf`** 目标转速 = 【**商检制热风速**】
- **变频压机`COMPf`** 目标转速  = 【**商检制热频率**】
- **主路电子膨胀阀`EEVm`** 目标步数 = 【**商检制热步数**】

然后等待如下条件满足后进入步骤2：

- **变频压机`COMPf`** 转速 ≥【**压机启动转速**】-0.5rps

#### 步骤2：制热

满足以下所有条件会进步骤3：

- **排气温度`TD`** > **吸气温度`TS`**
- **排气温度`TD`** > **翅片温度`TF`**
- “**商检制热延时**”计时到 或 “**商检制热延时**”+“**商检制热超时**”计时到

如果“**商检制热延时**”+“**商检制热超时**”计时到后没有达到上述条件，则外机商检失败，报相应故障：

- **排气温度`TD`** ≤ **吸气温度`TS`**，未达到则报”**排气温度故障**”（**ERR E8**）
- **排气温度`TD`** ≤ **翅片温度`TF`**，未达到则报“**翅片温度故障**“（**ERR E3**）

> **注1**：**商检制热延时** = 【**商检制热时间**】除以100的余数
> **注2**：**商检制热超时** = 【**商检制热时间**】除以100的商

#### 步骤3：准备制冷1

准备制冷1执行动作：

- “空调模式” 设为制冷
- **变频风机`FANf`** 目标转速 = 【**商检制冷风速**】
- **变频压机`COMPf`** 目标转速 = 40rps
- **主路电子膨胀阀`EEVm`** 目标步数 = 【**商检制冷步数**】

然后等待如下条件满足后进入步骤4：

- 39.5rps > **变频压机`COMPf`** 转速 > 40.5rps

#### 步骤4：准备制冷2

准备制冷2执行动作：

- **变频压机`COMPf`** 转速 = 【**商检制冷频率**】

然后等待如下条件满足后进入步骤5：

- 【**商检制冷频率**】-0.5rps > **变频压机`COMPf`** 转速 > 【**商检制冷频率**】+0.5rps

#### 步骤5：制冷

满足以下所有条件后外机商检成功：

- **吸气温度`TS`** < **翅片温度`TF`**
- “**商检制冷延时**”计时到

如果“**商检制冷延时**”+“**商检制冷超时**”计时到后没有达到上述条件，则外机商检失败，报“**翅片温度故障**“（**ERR E3**）

> **注1**：**商检制冷延时** = 【**商检制冷时间**】除以100的余数
> **注2**：**商检制冷超时** = 【**商检制冷时间**】除以100的商

#### 外机商检结论

- 所有步骤都完成后，则商检屏显示 **Pass**，表示商检通过
